---
layout: post
title: "linux常用命令"
subtitle: "或许是最常用的基本命令"
author: "guanlili"
header-img: "img/about-bg.jpg"
header-img-credit: "@WebdesignerDepot"
header-img-credit-href: "medium.com/@WebdesignerDepot/poll-should-css-become-more-like-a-programming-language-c74eb26a4270"
header-mask: 0.4
tags:
  - linux
  - 实习
---

# **linux常用命令**


## **常用基本命令**

pwd 查看当前目录

sudo -i 进入root用户

vim 修改文件（彩色）

vim编辑器的安装：

 sudo apt-get install vim

创建文件vim word.txt

进入编辑器  i才可以编辑

esc退出编辑状态

 从键盘输入“:wq”三个英文字母，然后回车，表示保存文件并退出。

 从键盘输入“:q”两个英文字母，然后回车，表示不保存并退出。

 从键盘输入“:q!”三个英文字母，然后回车，表示不保存并强制退出。

vi 修改文件（黑白）
cd ..返回
cd ~ 返回家目录
ls 查看

ssh dp@

ssh root@182.92.235.195 阿里云

mkdir新建文件夹

wget 下载链接

rm -rf 2.6.0 删除2.6.0文件夹

mv  移动命令例：mv /home/1.txt  /opt/”，这个命令是将/home目录下的1.txt移动到 /opt目录下，命令执行后home目录下的1.txt将会被删除。

cp 复制 

 cp -r 要移动的文件夹  目标文件夹

修改文件名字
 语句：mv oldFileName  newFileName

示例：我想把 aaa.txt修改为 bbb.txt

   示例语句：mv  aaa.txt  bbb.txt

把当前目录下的file1文件名改成file2，如果该目录下有file2，则覆盖以前的file2文件。

$ tar zxvf 文件 f后面一定跟着压缩文件的名称，

df-h查看内存信息

docker ps查看运行的容器

docker ps -a查看所有容器（包括未运行）

docker images查看容器镜像

docker pull +镜像名称 /重新拉镜像

docker rm -f a78cb7e1295d 强制删除容器停不掉

docker exec -it 654be3061da5 curl -XPUT manager:2222/dptasks/5/restart /绕过前端重启容器


chmod +x test.sh 给脚本赋予可执行的权限

2.6.0 / data pipeline / singlehost  /各种脚本

 ./restart.sh dp-thrall-webservice重启webservice



./restart.sh 才能启动脚本

查看日志

cd /data/datapipeline/log/sinkdp/  先进入到日志的目录

cat 423ef181118c.log  | grep Insert 查看423ef181118c日志，查找Insert字符串

cat 423ef181118c*  | grep Insert  查所有的日志 从中查找Insert字符串

查询本机ip curl cip.cc



新机器Docker compose 改邮箱，避免发送到所有人 然后重启一下

修改文件夹名字
把jumper_2.6.5guan文件夹名字改成jumper_2.6.5
 mv  jumper_2.6.5guan  jumper_2.6.5

绕过前端重启任务
 docker exec -it fd6246b8097f curl -XPUT manager:2222/dptasks/12/restart

## **关于升级**

### **清空环境**

（升级或者换版本需要清空环境 ps:小版本不需要清空环境 直接改singlehost）

1.先stop

(强制停掉所有的容器

docker-compose -f docker-compose_32G.yml down)

2.两条命令

2.7版本每次需要拷贝一个文件

cp  resource_group_config.json /data/datapipeline/dpconfig/

3.改版本号(有更新需要pull.sh镜像)

4.start.all

rm -rf /data/datapipeline

docker volume rm $(docker volume ls -q)



微软云，4核16GB 256GB磁盘 CentOS7.6

guanlili-test



### **清理服务器的数据**

先找到compose 16g的目录下，执行stop脚本，然后分开执行以下两个命令

rm -rf /data/datapipeline

docker volume rm $(docker volume ls -q)

执行 startall脚本

### **小版本升级（默认）**

1.直接改版本号。（不清环境）

2.执行up.sh脚本，或restart.sh 

dp-thrall-mysql dp-thrall-webservice sourcedp1 sinkdp1 manager   dashboard

### **数据服务升级**

数据服务

1.singhost 下的dockercompose  修改thirdparty-service的image 版本号

2.重启thirdparty-service


### **API相关**

API-content-string

http://192.168.2.17:5001/restful/api/path/rrrr

rrrr 

stri45678ng



"awsSqsName": "s3-test-queue",

​        "s3AccessId": "AKIAOWSRYE4XCKMOZU2A",

​        "s3AccessKey": "wrgzpZqvdEeCQaYYZQjYX2UJWn8IWKdSfhgPR6er",

## **关于跳板机jumper**

### **jumper环境**

分别进入到jumper和singhost目录下，执行stop脚本

rm -rf /data/datapipeline

docker volume rm $(docker volume ls -q)

分别在jumper和singhost目录下执行startall脚本

升级jumper docker下改jumper版本号，再改前端版本，

重启jumper （重新拉镜像，如果名字变了 restart自动pull)

重启webservice source sink manager mysqldashboard

#### **重新拉一下jumper脚本**

(有时名字尽管一样，但也要重新拉一次，可能是内部更新但是名字没变，每次都可以重新拉一下试试)

docker pull registry.datapipeline.com/dp-jumper:1.2.6.5 //registry后是粘贴的

## **关于配置**

### **Hive配置问题**

#### **添加hive映射**

 脚本写不进去hive和hdfs目的地

单机版配置的时候 创建hive 

传了三个文件依然不好使 去终端配置参数 

进入服务器-root权限 cd /root



root路径下，vim创建一个文件，hosts

vim hosts

粘贴

192.168.2.23 skafka

192.168.2.14 cdh01 kerberos.dp.com

192.168.2.15 cdh02

192.168.2.16 cdh03



192.168.2.32 hive-cdh-01

192.168.2.33 hive-cdh-02

192.168.2.34 hive-cdh-03



192.168.2.25 kcdh01

192.168.2.26 kcdh02

192.168.2.27 kcdh03



192.168.2.23 zookeeper

192.168.2.23 skafka

192.168.2.23 source_schema_registry

保存退出 进入singlehost 

cd 2.6.5/datapipeline/singlehost/

配置文件

vim docker-compose_16G.yml

在文件下的 webservice\source\sink\manager的volume下面分别粘贴- /root/hosts:/etc/hosts（需要对齐）

保存退出

./restart.sh 

配置结束重启即可



## **关于报错**



解决ORA-21561: OID generation failed

在Mac上用Navicat连接Oracle的时候总是提示：ORA-21561: OID generation failed

解决过程

在终端上输入：~ hostname

localhost

查看/etc/hosts文件：~ cat /etc/hosts

127.0.0.1 localhost

保持hostname与hosts文件中127.0.0.1对应的名称一致即可！

**========================================**

修改hostname命令

sudo scutil --set HostName yourname





激活码

bogon:~ sss$ cd Desktop/

bogon:Desktop sss$ java -jar dp-encoder.jar

请输入客户公司(客户标识):hongli-test

请输入到期时间(时间戳):9999999999

是否为高级版(false:不是, true:是):true

bogon:Desktop sss$ 

激活后的密钥

http://40.73.16.128/pipelines

egDzM6Y5gy0s//MElBWgn+5SPljFz73low/O3Wt4Qtj1msgUUIhM8LSGEPbiWRQrl/32Biqje+0zhnxv8q1rKGusf5ewDRXGtZ8D8J/vyV8=

http://40.73.31.202/pipelines
clRkzVy4WP8ibmwd4sAeCh7MXzPjkTJPzND+DdvbSpCPjSZcO+JbECTn5Im7fyEc2CB5n34YsbNtkN/BTsqFUsDE2XCNoat2kVTYm8SwOfI=

http://40.73.31.201/pipelines
RP09cBNbYWdD8Y5qtnrp8m9lnbU1nnaA5oct+ZeFG1spkHVJIyezUpwQX76tbdk8+0QzHV6PI2lmVEUJyCos6Wusf5ewDRXGtZ8D8J/vyV8=

## **升级测试**
集群需要注意：

/root/datapipeline/cluster下的脚本直接执行就行

要使用docker service rm 容器名来停止

[root@dp27m1 node1]# docker service rm sourcedp1
sourcedp1

[root@dp27m1 cluster]# docker exec -it 6c72219cb515 bash  

清理redis缓存(有多个redis使用redis1) 在node2节点里。node2中有redis容器。只清理redis1就行

准备新的配置文件resource_group_config.json（集群每一个都配置文件）

分别在脚本里找source和sink找CONNECT_GROUP_ID参数，把cp resource_group_config.json改成一致（每个节点都要改）

文件确认 groupName group_connect_source  group_connect_sink nodes   source sink名字dp1还是dp

将配置文件映射到dp-thrall-webservice, manager,sourcedp,sinkdp容器中

source、sink、manager文件需要你参考已有的mount挂载格式来写  
dp-thrall-webservice不用挂载，resource文件放在/data/datapipeline/dpconfig就行

/root/datapipeline/dpconfig:/dpconfig

--mount type=bind,src=/root/datapipeline/dpconfig,dst=/dpconfig \



这个resource...文件在dp-thrall-webservice脚本中目录是/data/

将原本/root下的resource文件复制到/data下的相应目录即可

文件配置完把文件拷data下

cp resource_group_config.json /data/datapipeline/dpconfig/


vim dp-2.6-2.7-add-config.sh

脚本确认#source 和 sink 的 CONNECT_GROUP_ID #mysql密码，视客户具体情况而定

（可以在manifest中搜一下WEB_LIST 看表示/data下还是/root下）

## **关于corn表达式**

 corn表达式
0 48 14 ? * 1
意思是每周一的14：48